# OpenAI Provider Fingerprinting
# API Documentation: https://platform.openai.com/docs/api-reference

provider: openai
display_name: "OpenAI"
base_urls:
  - https://api.openai.com

# === Authentication ===
auth:
  type: api_key
  header: "Authorization"
  format: "Bearer {key}"
  key_patterns:
    - pattern: "^sk-[a-zA-Z0-9]{48}$"
      description: "Legacy API key"
      account_type: unknown
    - pattern: "^sk-proj-[a-zA-Z0-9]{48}$"
      description: "Project API key"
      account_type: corporate
    - pattern: "^sk-svcacct-[a-zA-Z0-9]+"
      description: "Service account key"
      account_type: corporate
  organization_header: "OpenAI-Organization"
  project_header: "OpenAI-Project"

# === Endpoints ===
endpoints:
  chat_completions:
    path: "/v1/chat/completions"
    method: POST
    request_type: chat
    streaming:
      indicator:
        body_field: "stream"
        value: true
      content_type: "text/event-stream"
    request_extraction:
      model: "$.model"
      messages: "$.messages"
      temperature: "$.temperature"
      max_tokens: "$.max_tokens"
      tools: "$.tools"
      tool_choice: "$.tool_choice"
      stream: "$.stream"
    response_extraction:
      model: "$.model"
      request_id: 
        header: "x-request-id"
      choices: "$.choices"
      usage:
        prompt_tokens: "$.usage.prompt_tokens"
        completion_tokens: "$.usage.completion_tokens"
        total_tokens: "$.usage.total_tokens"
      finish_reason: "$.choices[0].finish_reason"
      
  completions:
    path: "/v1/completions"
    method: POST
    request_type: completion
    deprecated: true
    request_extraction:
      model: "$.model"
      prompt: "$.prompt"
      
  embeddings:
    path: "/v1/embeddings"
    method: POST
    request_type: embedding
    request_extraction:
      model: "$.model"
      input: "$.input"
    response_extraction:
      usage:
        prompt_tokens: "$.usage.prompt_tokens"
        total_tokens: "$.usage.total_tokens"
        
  images_generations:
    path: "/v1/images/generations"
    method: POST
    request_type: image
    request_extraction:
      model: "$.model"
      prompt: "$.prompt"
      size: "$.size"
      quality: "$.quality"
      
  audio_transcriptions:
    path: "/v1/audio/transcriptions"
    method: POST
    request_type: audio
    content_type: "multipart/form-data"
    
  audio_speech:
    path: "/v1/audio/speech"
    method: POST
    request_type: audio
    request_extraction:
      model: "$.model"
      voice: "$.voice"
      
  moderations:
    path: "/v1/moderations"
    method: POST
    request_type: moderation

# === Response Headers ===
response_headers:
  request_id: "x-request-id"
  ratelimit_limit: "x-ratelimit-limit-requests"
  ratelimit_remaining: "x-ratelimit-remaining-requests"
  ratelimit_reset: "x-ratelimit-reset-requests"
  organization: "openai-organization"
  processing_ms: "openai-processing-ms"
  model: "openai-model"
  version: "openai-version"

# === Models ===
# Model data is auto-generated from LiteLLM. See:
#   semconv/providers/_generated/models.yaml
#   semconv/providers/_generated/models.json
#
# To update model data, run:
#   python scripts/sync-models.py
#
# Model families for grouping (manually maintained):
model_families:
  gpt-4o:
    pattern: "^gpt-4o"
    display_name: "GPT-4o"
    
  o1:
    pattern: "^o1"
    display_name: "O1 Reasoning"
    
  gpt-4:
    pattern: "^gpt-4(?!o)"
    display_name: "GPT-4"
    
  gpt-3.5:
    pattern: "^gpt-3\\.5"
    display_name: "GPT-3.5"
    
  embedding:
    pattern: "^text-embedding"
    display_name: "Embeddings"
    
  dall-e:
    pattern: "^dall-e"
    display_name: "DALL-E"
    
  whisper:
    pattern: "^whisper"
    display_name: "Whisper"
    
  tts:
    pattern: "^tts"
    display_name: "Text-to-Speech"

# === Fingerprinting Signals ===
fingerprints:
  high_confidence:
    - domain: "api.openai.com"
      path_prefix: "/v1/"
      has_model_field: true
      
  medium_confidence:
    - domain: "api.openai.com"
      path_prefix: "/v1/"
      
  response_signals:
    - header: "openai-organization"
    - header: "openai-processing-ms"
    - body_field: "$.object"
      values: ["chat.completion", "text_completion", "embedding", "moderation"]
    - body_field: "$.id"
      pattern: "^chatcmpl-[a-zA-Z0-9]+"

